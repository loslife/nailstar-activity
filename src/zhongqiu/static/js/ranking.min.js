jQuery(function(n){function i(i){s(u+"info/"+i,function(i,e){return 0!=e.code?void console.log("err"):(n(".me-left img").attr("src",e.result.url),n(".userimg img").attr("src",e.result.avatar),n(".username").text(e.result.nickname),n("#num").text(e.result.vote),n("#ranknum").text(e.result.ranking),void t(e.result.ranking))})}function e(i){s(u+"infos/?page="+i,function(e,t){return 0!=t.code?void console.log("err"):(1==i?(a(t.result.datas),o(t.result.datas),setTimeout(function(i){n(".loadercontent").hide()},500)):o(t.result.datas),r(),0==t.result.datas.length?void(g.view.scroll=!1):(setTimeout(function(){g.view.scroll=!0},500),void g.view.page++))})}function t(i){1==i?n(".awardthings img").attr("src","http://s.naildaka.com/zhongqiu/images/ranking-1.png"):i>1&&4>i?n(".awardthings img").attr("src","http://s.naildaka.com/zhongqiu/images/ranking-2.png"):i>3&&16>i?n(".awardthings img").attr("src","http://s.naildaka.com/zhongqiu/images/ranking-4.png"):i>15&&51>i?n(".awardthings img").attr("src","http://s.naildaka.com/zhongqiu/images/ranking-chongdian.png"):n(".awardthings img").hide()}function a(i){for(var e,t={a:"http://s.naildaka.com/zhongqiu/images/ranking-1.png",b:"http://s.naildaka.com/zhongqiu/images/ranking-2.png",c:"http://s.naildaka.com/zhongqiu/images/ranking-3.png",d:"http://s.naildaka.com/zhongqiu/images/ranking-chongdian.png"},a={a:"color1",b:"color2"},o=0;o<i.length;o++){var r=o+1;e=0==o?t.a:o>0&&3>o?t.b:o>2&&15>o?t.c:t.d;var s;s=o%2==0?a.a:a.b;var c='<li class="'+s+' item db ba-c bo-h"><div class="ranknumber">'+r+'</div><div class="rankimg"><img src="'+i[o].avatar+'" alt=""></div><div class="rankname">'+i[o].nickname+'</div><div class="ranktxt">当前票数</div><div class="rankpiao">'+i[o].vote+'</div><div class="rankaward"><img src="'+e+'" alt=""></div></li>';if(o>49)return;n(".ranklist").append(c)}}function o(i){for(var e=0;e<i.length;e++){var t='<li><div class="top"><img src="'+i[e].url+'" alt=""></div><div class="bottom db bo-h ba-c"><div class="mx-userimg"><img src="'+i[e].avatar+'" alt=""></div><div class="mx-name">'+i[e].nickname+'</div><div>票数</div><div class="mx-number">'+i[e].vote+'</div></div><div class="mx-btn" unionid-data="'+i[e].unionid+'">给Ta投票</div></li>';n("#mxlist").append(t)}}function r(){n(".mx-btn").each(function(){n(this).unbind("click").click(function(){var i=n(this);i.css("background-color","#b1b1b1"),i.text("已投票");var e={friend_union_id:i.attr("unionid-data"),my_union_id:g.union_id,source:1};c(u+"vote",e,function(n,e){if(0!=e.code)return void alert("请勿重复投票");var t=parseInt(i.prev().children("div.mx-number").text())+1;i.prev().children("div.mx-number").text(t)})})})}function s(i,e){n.ajax({type:"GET",url:i,beforeSend:function(n){n.setRequestHeader("xhr","true")},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(n){e(null,n)},error:function(n){e(!0)},dataType:"json"})}function c(i,e,t){n.ajax({type:"POST",url:i,data:e,beforeSend:function(n){n.setRequestHeader("xhr","true")},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(n){t(null,n)},error:function(n){console.log(n)},dataType:"json"})}function d(){var i="wxa84c9db4a6fcc7d8",e=window.location.href,t="http://huodong.naildaka.com/wx/getSignature";n.ajax({type:"POST",url:t,data:{url:e,appId:i},beforeSend:function(n){},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(n){var e=n.result.sign;wx.config({debug:!1,appId:i,timestamp:1421670369,nonceStr:"q2XFkAiqofKmi1Y2",signature:e,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","chooseImage","previewImage","uploadImage","downloadImage","getNetworkType"]}),wx.ready(function(){var n={imgUrl:"http://s.naildaka.com/zhongqiu/images/share.jpg",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb931d3d24994df52&redirect_uri=http%3a%2f%2fhuodong.naildaka.com%2fsvc%2fzhongqiu%2froute%2f"+g.union_id+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect",desc:"我离玫瑰金只有一步之差，你还在等啥？ 晒自拍，多重豪礼等你拿！",title:"你负责貌美如花，大咖负责把iPhone6s送进家！",appId:i},e={imgUrl:"http://s.naildaka.com/zhongqiu/images/share.jpg",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb931d3d24994df52&redirect_uri=http%3a%2f%2fhuodong.naildaka.com%2fsvc%2fzhongqiu%2froute%2f"+g.union_id+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect",desc:"我离玫瑰金只有一步之差，你还在等啥？ 晒自拍，多重豪礼等你拿！",title:"你负责貌美如花，大咖负责把iPhone6s送进家！",appId:i};wx.onMenuShareTimeline({title:e.desc,link:e.link,imgUrl:e.imgUrl,success:function(n){s("http://huodong.naildaka.com/svc/stat/share?activity=zhongqiu",function(n,i){0!=i.code?console.log("err"):console.log("ok")})},cancel:function(){}}),wx.onMenuShareAppMessage({title:n.title,desc:n.desc,link:n.link,imgUrl:n.imgUrl,type:"",dataUrl:"",success:function(){s("http://huodong.naildaka.com/svc/stat/share?activity=zhongqiu",function(n,i){0!=i.code?console.log("err"):console.log("ok")})},cancel:function(){}})})},error:function(n){console.log(n)},dataType:"json"})}function l(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),e=window.location.search.substr(1).match(i);return null!=e?unescape(e[2]):null}var u="http://huodong.naildaka.com/svc/zhongqiu/",h=Date.parse("Oct 4, 2015");setInterval(function(){var i=(new Date).getTime(),e=new Date(h-i).lastTime();n("#h").text(e)},1e3);var g={view:{loadpage:!0,sharetips:!1,tab:!0,page:1,scroll:!0},union_id:""};g.union_id=l("union_id"),n(".tab-left").click(function(){g.view.tab||(g.view.tab=!0,n(".timetips").show(),n(".renqi").show(),n(".mx").hide(),n("html,body").scrollTop(0),n(".content .tab-left").hide(),n(".content .tab-right").hide(),n(".content .tab-left.on").show(),n(".content .tab-right.off").show())}),n(".tab-right").click(function(){g.view.tab&&(g.view.tab=!1,n(".timetips").hide(),n(".renqi").hide(),n(".mx").show(),n("html,body").scrollTop(0),n(".content .tab-left").hide(),n(".content .tab-right").hide(),n(".content .tab-right.on").show(),n(".content .tab-left.off").show())}),n(".share").click(function(){n(".maskShare").show()}),n(".maskShare").click(function(){n(".maskShare").hide()}),i(g.union_id),e(g.view.page);var m=window.navigator.userAgent.toLowerCase();"micromessenger"==m.match(/MicroMessenger/i)&&d(),window.onscroll=function(){if(g.view.scroll){var i=n(window).scrollTop()+n(window).height()>n(document).height()-100;i&&(g.view.scroll=!1,e(g.view.page))}else console.log("不能滚动")}}),Date.prototype.lastTime=function(){var n=this.getTime(),i=Math.floor(n/36e5),e=Math.floor(n/6e4-60*i);if(i>23){var t=Math.ceil(i/24);return t+" 天"}10>e&&(e="0"+e);var a=Math.floor(n/1e3-60*e-3600*i);return 10>a&&(a="0"+a),i+" : "+e+" : "+a};