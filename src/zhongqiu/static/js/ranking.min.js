jQuery(function(e){function a(a){r(d+"info/"+a,function(a,n){0!=n.code?console.log("err"):(e(".me-left img").attr("src",n.result.url),e(".userimg img").attr("src",n.result.avatar),e(".username").text(n.result.nickname),e("#num").text(n.result.vote),e("#ranknum").text(n.result.ranking),i(n.result.ranking))})}function n(a){r(d+"infos/?page="+a,function(n,i){0!=i.code?console.log("err"):(1==a?(t(i.result.datas),o(i.result.datas),setTimeout(function(a){e(".loadercontent").hide()},500)):o(i.result.datas),0==i.result.datas.length&&(g.view.scroll=!1),a++)})}function i(a){1==a&&e(".awardthings img").attr("src","./images/ranking-1.png"),a>1&&4>a&&e(".awardthings img").attr("src","./images/ranking-2.png"),a>3&&16>a?e(".awardthings img").attr("src","./images/ranking-4.png"):e(".awardthings img").hide()}function t(a){for(var n,i={a:"./images/ranking-1.png",b:"./images/ranking-2.png",c:"./images/ranking-4.png"},t={a:"color1",b:"color2"},o=0;o<a.length;o++){var r=o+1;if(0==o?(n=i.a,console.log(n)):o>0&&3>o?(n=i.b,console.log(n)):o>2&&15>o&&(n=i.c,console.log(n)),o%2==0)var s=t.a;else var s=t.b;var c='<li class="'+s+' item db ba-c bo-h"><div class="ranknumber">'+r+'</div><div class="rankimg"><img src="'+a[o].avatar+'" alt=""></div><div class="rankname">'+a[o].nickname+'</div><div class="ranktxt">当前票数</div><div class="rankpiao">'+a[o].vote+'</div><div class="rankaward"><img src="'+n+'" alt=""></div></li>';e(".ranklist").append(c)}}function o(a){for(var n=0;n<a.length;n++){console.log("2"+a[n]);var i='<li><div class="top"><img src="'+a[n].url+'" alt=""></div><div class="bottom db bo-h ba-c"><div class="mx-userimg"><img src="'+a[n].avatar+'" alt=""></div><div class="mx-name">'+a[n].nickname+'</div><div>票数</div><div class="mx-number">'+a[n].vote+"</div></div></li>";e("#mxlist").append(i)}}function r(a,n){e.ajax({type:"GET",url:a,beforeSend:function(e){e.setRequestHeader("xhr","true")},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){n(null,e)},error:function(e){n(!0)},dataType:"json"})}function s(){var a="wxa84c9db4a6fcc7d8",n=window.location.href,i="http://huodong.naildaka.com/wx/getSignature";e.ajax({type:"POST",url:i,data:{url:n,appId:a},beforeSend:function(e){},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){var n=e.result.sign;wx.config({debug:!1,appId:a,timestamp:1421670369,nonceStr:"q2XFkAiqofKmi1Y2",signature:n,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","chooseImage","previewImage","uploadImage","downloadImage","getNetworkType"]}),wx.ready(function(){var e={imgUrl:"http://huodong.naildaka.com/zhongqiu/images/share.jpg",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb931d3d24994df52&redirect_uri=http%3a%2f%2fhuodong.naildaka.com%2fsvc%2fzhongqiu%2froute%2f"+g.union_id+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect",desc:"我离玫瑰金只有一步之差，你还在等啥？ 晒自拍，多重豪礼等你拿！",title:"你负责貌美如花，大咖负责把iPhone6s送进家！",appId:a},n={imgUrl:"http://huodong.naildaka.com/zhongqiu/images/share.jpg",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb931d3d24994df52&redirect_uri=http%3a%2f%2fhuodong.naildaka.com%2fsvc%2fzhongqiu%2froute%2f"+g.union_id+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect",desc:"我离玫瑰金只有一步之差，你还在等啥？ 晒自拍，多重豪礼等你拿！",title:"你负责貌美如花，大咖负责把iPhone6s送进家！",appId:a};wx.onMenuShareTimeline({title:n.desc,link:n.link,imgUrl:n.imgUrl,success:function(e){r("http://huodong.naildaka.com/svc/stat/share?activity=zhongqiu",function(e,a){0!=a.code?console.log("err"):console.log("ok")})},cancel:function(){}}),wx.onMenuShareAppMessage({title:e.title,desc:e.desc,link:e.link,imgUrl:e.imgUrl,type:"",dataUrl:"",success:function(){r("http://huodong.naildaka.com/svc/stat/share?activity=zhongqiu",function(e,a){0!=a.code?console.log("err"):console.log("ok")})},cancel:function(){}})})},error:function(e){console.log(e)},dataType:"json"})}function c(e){var a=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(a);return null!=n?unescape(n[2]):null}var l=Date.parse("Oct 4, 2015");setInterval(function(){var a=(new Date).getTime(),n=new Date(l-a).lastTime();e("#h").text(n)},1e3);var g={view:{loadpage:!0,sharetips:!1,tab:!0,page:1,scroll:!0},union_id:""};g.union_id=c("union_id"),e(".tab-left").click(function(){g.view.tab||(g.view.tab=!0,e(".tab-left img").attr("src","./images/rank-left-btn1.png"),e(".tab-right img").attr("src","./images/rank-right-btn2.png"),e(".renqi").show(),e(".mx").hide(),e("html,body").scrollTop(0))}),e(".tab-right").click(function(){g.view.tab&&(g.view.tab=!1,e(".tab-left img").attr("src","./images/rank-left-btn2.png"),e(".tab-right img").attr("src","./images/rank-right-btn1.png"),e(".renqi").hide(),e(".mx").show(),e("html,body").scrollTop(0),e("#waterfall li").wookmark({autoResize:!0,container:e("#mxlist"),offset:6}))}),e(".share").click(function(){e(".maskShare").show()}),e(".maskShare").click(function(){e(".maskShare").hide()});var d="http://huodong.naildaka.com/svc/zhongqiu/";a(g.union_id),n(g.view.page);var u=window.navigator.userAgent.toLowerCase();"micromessenger"==u.match(/MicroMessenger/i)&&s(),window.onscroll=function(){if(g.view.scroll){var a=e(window).scrollTop()+e(window).height()>e(document).height()-100;a&&n(g.view.page)}else console.log("不能滚动")}}),Date.prototype.lastTime=function(){var e=this.getTime(),a=Math.floor(e/36e5),n=Math.floor(e/6e4-60*a);10>n&&(n="0"+n);var i=Math.floor(e/1e3-60*n-3600*a);return 10>i&&(i="0"+i),a+" : "+n+" : "+i};