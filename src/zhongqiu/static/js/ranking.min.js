jQuery(function(i){function n(n){s(u+"info/"+n,function(n,a){return 0!=a.code?void console.log("err"):(i(".me-left img").attr("src",a.result.url),i(".userimg img").attr("src",a.result.avatar),i(".username").text(a.result.nickname),i("#num").text(a.result.vote),i("#ranknum").text(a.result.ranking),void t(a.result.ranking))})}function a(n){s(u+"infos/?page="+n,function(a,t){return 0!=t.code?void console.log("err"):(1==n?(e(t.result.datas),o(t.result.datas),setTimeout(function(n){i(".loadercontent").hide()},500)):o(t.result.datas),r(),0==t.result.datas.length?void(h.view.scroll=!1):(setTimeout(function(){h.view.scroll=!0},500),void h.view.page++))})}function t(n){1==n?i(".awardthings img").attr("src","http://s.naildaka.com/zhongqiu/images/ranking-1.png"):n>1&&4>n?i(".awardthings img").attr("src","http://s.naildaka.com/zhongqiu/images/ranking-2.png"):n>3&&16>n?i(".awardthings img").attr("src","http://s.naildaka.com/zhongqiu/images/ranking-4.png"):n>15&&51>n?i(".awardthings img").attr("src","http://s.naildaka.com/zhongqiu/images/ranking-chongdian.png"):i(".awardthings img").hide()}function e(n){for(var a,t={a:"http://s.naildaka.com/zhongqiu/images/ranking-1.png",b:"http://s.naildaka.com/zhongqiu/images/ranking-2.png",c:"http://s.naildaka.com/zhongqiu/images/ranking-3.png",d:"http://s.naildaka.com/zhongqiu/images/ranking-chongdian.png"},e={a:"color1",b:"color2"},o=0;o<n.length;o++){var r=o+1;a=0==o?t.a:o>0&&3>o?t.b:o>2&&15>o?t.c:t.d;var s;s=o%2==0?e.a:e.b;var c='<li class="'+s+' item db ba-c bo-h"><div class="ranknumber">'+r+'</div><div class="rankimg"><img src="'+n[o].avatar+'" alt=""></div><div class="rankname">'+n[o].nickname+'</div><div class="ranktxt">当前票数</div><div class="rankpiao">'+n[o].vote+'</div><div class="rankaward"><img src="'+a+'" alt=""></div></li>';if(o>49)return;i(".ranklist").append(c)}}function o(n){for(var a=0;a<n.length;a++){var t='<li><div class="top"><img src="'+n[a].url+'" alt=""></div><div class="bottom db bo-h ba-c"><div class="mx-userimg"><img src="'+n[a].avatar+'" alt=""></div><div class="mx-name">'+n[a].nickname+'</div><div>票数</div><div class="mx-number">'+n[a].vote+'</div></div><div class="mx-btn" unionid-data="'+n[a].unionid+'">给Ta投票</div></li>';i("#mxlist").append(t)}}function r(){i(".mx-btn").each(function(){i(this).unbind("click").click(function(){var n=i(this);n.css("background-color","#b1b1b1"),n.text("已投票");var a={friend_union_id:n.attr("unionid-data"),my_union_id:h.union_id,source:1};c(u+"vote",a,function(i,a){if(0!=a.code)return void alert("请勿重复投票");var t=parseInt(n.prev().children("div.mx-number").text())+1;n.prev().children("div.mx-number").text(t)})})})}function s(n,a){i.ajax({type:"GET",url:n,beforeSend:function(i){i.setRequestHeader("xhr","true")},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(i){a(null,i)},error:function(i){a(!0)},dataType:"json"})}function c(n,a,t){i.ajax({type:"POST",url:n,data:a,beforeSend:function(i){i.setRequestHeader("xhr","true")},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(i){t(null,i)},error:function(i){console.log(i)},dataType:"json"})}function l(){var n="wxa84c9db4a6fcc7d8",a=window.location.href,t="http://huodong.naildaka.com/wx/getSignature";i.ajax({type:"POST",url:t,data:{url:a,appId:n},beforeSend:function(i){},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(i){var a=i.result.sign;wx.config({debug:!1,appId:n,timestamp:1421670369,nonceStr:"q2XFkAiqofKmi1Y2",signature:a,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","chooseImage","previewImage","uploadImage","downloadImage","getNetworkType"]}),wx.ready(function(){var i={imgUrl:"http://s.naildaka.com/zhongqiu/images/share.jpg",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb931d3d24994df52&redirect_uri=http%3a%2f%2fhuodong.naildaka.com%2fsvc%2fzhongqiu%2froute%2f"+h.union_id+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect",desc:"我离玫瑰金只有一步之差，你还在等啥？ 晒自拍，多重豪礼等你拿！",title:"你负责貌美如花，大咖负责把iPhone6s送进家！",appId:n},a={imgUrl:"http://s.naildaka.com/zhongqiu/images/share.jpg",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb931d3d24994df52&redirect_uri=http%3a%2f%2fhuodong.naildaka.com%2fsvc%2fzhongqiu%2froute%2f"+h.union_id+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect",desc:"我离玫瑰金只有一步之差，你还在等啥？ 晒自拍，多重豪礼等你拿！",title:"你负责貌美如花，大咖负责把iPhone6s送进家！",appId:n};wx.onMenuShareTimeline({title:a.desc,link:a.link,imgUrl:a.imgUrl,success:function(i){s("http://huodong.naildaka.com/svc/stat/share?activity=zhongqiu",function(i,n){0!=n.code?console.log("err"):console.log("ok")})},cancel:function(){}}),wx.onMenuShareAppMessage({title:i.title,desc:i.desc,link:i.link,imgUrl:i.imgUrl,type:"",dataUrl:"",success:function(){s("http://huodong.naildaka.com/svc/stat/share?activity=zhongqiu",function(i,n){0!=n.code?console.log("err"):console.log("ok")})},cancel:function(){}})})},error:function(i){console.log(i)},dataType:"json"})}function d(i){var n=new RegExp("(^|&)"+i+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(n);return null!=a?unescape(a[2]):null}var u="http://huodong.naildaka.com/svc/zhongqiu/",g=Date.parse("Oct 4, 2015");setInterval(function(){var n=(new Date).getTime(),a=new Date(g-n).lastTime();i("#h").text(a)},1e3);var h={view:{loadpage:!0,sharetips:!1,tab:!0,page:1,scroll:!0},union_id:""};h.union_id=d("union_id"),i(".tab-left").click(function(){h.view.tab||(h.view.tab=!0,i(".timetips").show(),i(".renqi").show(),i(".mx").hide(),i("html,body").scrollTop(0),i(".tab-left img").attr("src","http://s.naildaka.com/zhongqiu/images/rank-left-btn1.png"),i(".tab-right img").attr("src","http://s.naildaka.com/zhongqiu/images/rank-right-btn2.png"))}),i(".tab-right").click(function(){h.view.tab&&(h.view.tab=!1,i(".timetips").hide(),i(".renqi").hide(),i(".mx").show(),i("html,body").scrollTop(0),i(".tab-left img").attr("src","http://s.naildaka.com/zhongqiu/images/rank-left-btn2.png"),i(".tab-right img").attr("src","http://s.naildaka.com/zhongqiu/images/rank-right-btn1.png"))}),i(".share").click(function(){i(".maskShare").show()}),i(".maskShare").click(function(){i(".maskShare").hide()}),n(h.union_id),a(h.view.page);var m=window.navigator.userAgent.toLowerCase();"micromessenger"==m.match(/MicroMessenger/i)&&l(),window.onscroll=function(){if(h.view.scroll){var n=i(window).scrollTop()+i(window).height()>i(document).height()-100;n&&(h.view.scroll=!1,a(h.view.page))}else console.log("不能滚动")}}),Date.prototype.lastTime=function(){var i=this.getTime(),n=Math.floor(i/36e5),a=Math.floor(i/6e4-60*n);if(n>23){var t=Math.ceil(n/24);return t+" 天"}10>a&&(a="0"+a);var e=Math.floor(i/1e3-60*a-3600*n);return 10>e&&(e="0"+e),n+" : "+a+" : "+e};