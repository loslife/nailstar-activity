function uploadImage(e,n){var o=host+"/uploadImage";postRequest(o,e,n)}function addRecord(e,n){var o=host+"/addRecord";postRequest(o,e,n)}function shareRecord(){getRequest("http://huodong.naildaka.com/svc/stat/share?activity=zhongqiu",function(e,n){0!=data.code?console.log("err"):console.log("ok")})}function postRequest(e,n,o){$.ajax({type:"POST",url:e,data:n,beforeSend:function(e){e.setRequestHeader("xhr","true")},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){o(null,e)},error:function(e){console.log(e)},dataType:"json"})}function getRequest(e,n){$.ajax({type:"GET",url:e,beforeSend:function(e){e.setRequestHeader("xhr","true")},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){n(null,e)},error:function(e){console.log(e)},dataType:"json"})}$(function(){function e(){var e=$(".img-container > img"),n={aspectRatio:1,autoCropArea:1,crop:function(e){},built:function(){}};e.cropper(n),$("#img-btn-cancel").click(function(){$("#preview-wrapper").hide()});var o=!1;$("#upload-image").click(function(){if(!o){$(".loadercontent").show();var n=e.cropper("getCroppedCanvas").toDataURL();uploadImage({image:n},function(e,n){if(o=!0,$("#preview-wrapper").hide(),e||!n||0!=n.code)return alert("上传失败，请重试");var i=n.result.picUrl;addRecord({picurl:i,unionid:t},function(e,n){return e||0!=n.code?alert("上传失败，请重试"):($(".loadercontent").hide(),void a(i))})})}})}function n(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),o=window.location.search.substr(1).match(n);return null!=o?unescape(o[2]):null}function o(){var e="wxa84c9db4a6fcc7d8",n=window.location.href,o="http://huodong.naildaka.com/wx/getSignature";$.ajax({type:"POST",url:o,data:{url:n,appId:e},beforeSend:function(e){},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(n){var o=n.result.sign;wx.config({debug:!1,appId:e,timestamp:1421670369,nonceStr:"q2XFkAiqofKmi1Y2",signature:o,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"]}),wx.ready(function(){var e="你负责貌美如花，大咖负责把iPhone6s送进家！",n="我离玫瑰金只有一步之差，你还在等啥？ 晒自拍，多重豪礼等你拿！",o="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb931d3d24994df52&redirect_uri=http%3a%2f%2fhuodong.naildaka.com%2fsvc%2fzhongqiu%2froute%2f"+t+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect",a=$(".transparency");wx.onMenuShareAppMessage({title:e,desc:n,link:o,imgUrl:"http://s.naildaka.com/zhongqiu/images/share.jpg",success:function(){a.hide(),shareRecord()},cancel:function(){a.hide(),shareRecord()}}),wx.onMenuShareTimeline({title:e,link:o,imgUrl:"http://s.naildaka.com/nishidaka/zhongqiu/images/share.jpg",success:function(){a.hide(),shareRecord()},cancel:function(){a.hide(),shareRecord()}})})},error:function(e){console.log(e)},dataType:"json"})}function a(e){$("#share .main-img2").attr("src",e),$("#introduce").hide(),$("#cover").hide(),$("#share").show();var n="你负责貌美如花，大咖负责把iPhone6s送进家！",o="我离玫瑰金只有一步之差，你还在等啥？ 晒自拍，多重豪礼等你拿！",a="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxb931d3d24994df52&redirect_uri=http%3a%2f%2fhuodong.naildaka.com%2fsvc%2fzhongqiu%2froute%2f"+t+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect",i=$(".transparency");wx.onMenuShareAppMessage({title:n,desc:o,link:a,imgUrl:e,success:function(){i.hide(),shareRecord()},cancel:function(){i.hide(),shareRecord()}}),wx.onMenuShareTimeline({title:n,link:a,imgUrl:e,success:function(){i.hide(),shareRecord()},cancel:function(){i.hide(),shareRecord()}})}var t=n("union_id");$(".loadercontent").hide(),$("body").on("touchmove",function(e){e.preventDefault()}),$(".transparency").on("click",function(){$(this).hide()}),e(),o(),$("#upload").on("click",function(){return t?void $("#uploadFile").click():alert("缺失union_id")}),$("#uploadFile").on("change",function(e){$(".loadercontent").show();var n=e.dataTransfer||e.target,o=n&&n.files&&n.files[0],a={canvas:!0};o&&loadImage.parseMetaData(o,function(e){e.exif&&(a.orientation=e.exif.get("Orientation")),loadImage(o,function(e){var n=e.toDataURL(),o=$(".img-container > img");o.attr("src",n),o.cropper("replace",n),$(".loadercontent").hide(),$("#preview-wrapper").show()},a)})}),$("#shareBtn").on("click",function(){$(".transparency").show()})});var host="http://huodong.naildaka.com/svc/zhongqiu";